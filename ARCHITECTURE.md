# ğŸ—ï¸ Arquitectura del Sistema - Snowflake NLP Agent v2

## ğŸ“‹ Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸŒ STREAMLIT WEB APP                                â”‚
â”‚                          (streamlit_app.py)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¨ UI Components:                                                          â”‚
â”‚  â”œâ”€ ğŸ’¬ Chat Interface (mensajes, historial)                                 â”‚
â”‚  â”œâ”€ ğŸ“Š Data Display (DataFrames, tablas formateadas)                       â”‚
â”‚  â”œâ”€ ğŸ”§ Sidebar (configuraciÃ³n, estado conexiÃ³n)                            â”‚
â”‚  â””â”€ ğŸ“‹ Logs Panel (trazabilidad proceso)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ user_input
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ§  NLP AGENT LAYER                                     â”‚
â”‚                   (src/agent/nlp_agent.py)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ğŸ¤– Groq LLM    â”‚    â”‚  ğŸ”— LangChain   â”‚    â”‚  ğŸ“ SQL Prompt  â”‚         â”‚
â”‚  â”‚ (Llama 3.3 70B) â”‚â—„â”€â”€â–ºâ”‚ SQLDatabaseChainâ”‚â—„â”€â”€â–ºâ”‚   (EspaÃ±ol)     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â”‚  Flujo:                                                                     â”‚
â”‚  1ï¸âƒ£ Recibe pregunta en espaÃ±ol                                              â”‚
â”‚  2ï¸âƒ£ Genera SQL usando LLM + prompt personalizado                           â”‚
â”‚  3ï¸âƒ£ Extrae SQL de intermediate_steps                                        â”‚
â”‚  4ï¸âƒ£ Ejecuta SQL directamente en Snowflake                                  â”‚
â”‚  5ï¸âƒ£ Registra pasos para trazabilidad                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ sql_query
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ğŸ—„ï¸  DATABASE LAYER                                      â”‚
â”‚                 (src/database/snowflake_conn.py)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ ğŸ”Œ Native       â”‚    â”‚ âš™ï¸  SQLAlchemy  â”‚    â”‚ ğŸ” Schema       â”‚         â”‚
â”‚  â”‚ Connector       â”‚    â”‚    Engine       â”‚    â”‚ Inspector       â”‚         â”‚
â”‚  â”‚                 â”‚    â”‚ (NullPool)      â”‚    â”‚                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â”‚  MÃ©todos principales:                                                       â”‚
â”‚  â€¢ connect() - Establece conexiÃ³n + validaciÃ³n                             â”‚
â”‚  â€¢ execute_query() - SQL â†’ filas + columnas                                â”‚
â”‚  â€¢ get_connection_string() - Para LangChain                                â”‚
â”‚  â€¢ get_connection_info() - Metadatos sesiÃ³n                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ sql_execution
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        â„ï¸  SNOWFLAKE CLOUD                                  â”‚
â”‚                     (External Data Warehouse)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ¢ Account: RNSWQJK-IU53947                                               â”‚
â”‚  ğŸ—ƒï¸  Database: SNOWFLAKE_SAMPLE_DATA                                        â”‚
â”‚  ğŸ“‹ Schema: TPCH_SF1                                                        â”‚
â”‚  ğŸ­ Warehouse: COMPUTE_WH                                                   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š Tablas disponibles:                                                     â”‚
â”‚  â”œâ”€ CUSTOMER (clientes)                                                     â”‚
â”‚  â”œâ”€ ORDERS (pedidos)                                                        â”‚
â”‚  â”œâ”€ LINEITEM (lÃ­neas de pedido)                                             â”‚
â”‚  â”œâ”€ PART (productos)                                                        â”‚
â”‚  â”œâ”€ SUPPLIER (proveedores)                                                  â”‚
â”‚  â””â”€ NATION, REGION (geografÃ­a)                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ query_results
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ“Š RESULT FORMATTING LAYER                              â”‚
â”‚                   (streamlit_app.py - formateo)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ”§ Funciones de formateo:                                                  â”‚
â”‚  â”œâ”€ parse_sql_result_string() - Parser strings â†’ listas                    â”‚
â”‚  â”œâ”€ format_sql_result_to_dataframe() - Formateo inteligente                â”‚
â”‚  â””â”€ DetecciÃ³n automÃ¡tica de tipos de consulta                              â”‚
â”‚                                                                             â”‚
â”‚  ğŸ¯ Tipos de formateo soportados:                                           â”‚
â”‚  â”œâ”€ ğŸ’° Pedidos con valores (formato monetario)                              â”‚
â”‚  â”œâ”€ ğŸ—‚ï¸  InformaciÃ³n de base de datos                                        â”‚
â”‚  â”œâ”€ ğŸ“‹ Listado de tablas                                                    â”‚
â”‚  â””â”€ ğŸ”€ Formato genÃ©rico (fallback)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ formatted_dataframe
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ğŸ‘¤ USER INTERFACE                                    â”‚
â”‚                    (Browser @ localhost:8501)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“± Resultados mostrados:                                                   â”‚
â”‚  â”œâ”€ ğŸ“Š Tablas interactivas (ancho completo)                                 â”‚
â”‚  â”œâ”€ ğŸ”¢ Contadores de registros                                              â”‚
â”‚  â”œâ”€ ğŸ’¬ Historial de conversaciÃ³n persistente                                â”‚
â”‚  â””â”€ ğŸ“‹ Logs de proceso paso a paso                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flujo de Datos Detallado

### 1. ğŸ¯ Entrada del Usuario
```
Usuario escribe: "Â¿CuÃ¡les son los 10 pedidos con mayor valor?"
                                â”‚
                                â–¼
                    process_user_input()
                                â”‚
                                â–¼
                    st.session_state.agent.process_query()
```

### 2. ğŸ§  Procesamiento NLP
```
SnowflakeNLPAgent.process_query()
    â”‚
    â”œâ”€ ğŸ” Log: "Procesando consulta"
    â”‚
    â”œâ”€ ğŸ¤– sql_chain.invoke(pregunta_espaÃ±ol)
    â”‚   â”‚
    â”‚   â”œâ”€ Groq LLM genera SQL usando prompt personalizado
    â”‚   â”œâ”€ Template incluye schema de tablas Snowflake
    â”‚   â””â”€ Devuelve: SQL + intermediate_steps
    â”‚
    â”œâ”€ ğŸ“ Extrae SQL de intermediate_steps[0]['sql_cmd']
    â”‚   â”‚
    â”‚   â””â”€ SQL: "SELECT o_orderkey, o_totalprice FROM orders ORDER BY o_totalprice DESC LIMIT 10"
    â”‚
    â”œâ”€ ğŸ§¹ Normaliza SQL (remueve markdown, backticks)
    â”‚
    â”œâ”€ ğŸš€ Ejecuta: self.db.run(cleaned_sql)
    â”‚   â”‚
    â”‚   â””â”€ Datos: [(1750466, Decimal('555285.16')), (4722021, Decimal('544089.09')), ...]
    â”‚
    â””â”€ ğŸ“Š Retorna: {success: True, result: datos, sql_query: sql}
```

### 3. ğŸ¨ Formateo y VisualizaciÃ³n
```
format_sql_result_to_dataframe(datos, sql, pregunta)
    â”‚
    â”œâ”€ ğŸ” Detecta tipo: "mayor valor" â†’ formato pedidos
    â”‚
    â”œâ”€ ğŸ’° Aplica formato monetario: "$555,285.16"
    â”‚
    â”œâ”€ ğŸ“‹ Crea DataFrame con columnas amigables:
    â”‚   â”‚
    â”‚   â””â”€ ['ID Pedido', 'Valor Total']
    â”‚
    â””â”€ ğŸ“Š st.dataframe(df, use_container_width=True)
```

## ğŸ›ï¸ Patrones de Arquitectura Utilizados

### ğŸ”§ Patrones de DiseÃ±o

| PatrÃ³n | ImplementaciÃ³n | UbicaciÃ³n |
|--------|---------------|-----------|
| **ğŸ”„ Chain of Responsibility** | LangChain SQLDatabaseChain | `nlp_agent.py` |
| **ğŸ­ Factory** | Connection string building | `snowflake_conn.py` |
| **ğŸ” Observer** | Logging system integration | Todos los mÃ³dulos |
| **ğŸ“¦ Singleton** | Global config, connection instances | `config.py`, `helpers.py` |
| **ğŸ¯ Strategy** | Formateo inteligente por tipo consulta | `streamlit_app.py` |
| **ğŸ”’ Context Manager** | Database connections (`with` statements) | `snowflake_conn.py` |

### ğŸŒŠ Arquitectura por Capas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¨ PRESENTATION LAYER (UI)                                     â”‚
â”‚  â””â”€ Streamlit components, chat interface, data display         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ â–²
           â–¼ â”‚  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§  BUSINESS LOGIC LAYER (NLP Agent)                           â”‚
â”‚  â””â”€ Natural language processing, SQL generation, execution     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ â–²
           â–¼ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—„ï¸  DATA ACCESS LAYER (Database Connection)                    â”‚
â”‚  â””â”€ Snowflake connectivity, query execution, result parsing    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ â–²
           â–¼ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â„ï¸  EXTERNAL SERVICES (Snowflake + Groq)                      â”‚
â”‚  â””â”€ Cloud data warehouse + LLM API services                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” GestiÃ³n de ConfiguraciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    âš™ï¸  CONFIGURATION FLOW                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  .env.example â”€â”€â”€â”€copyâ”€â”€â”€â–º .env â”€â”€â”€â”€loadâ”€â”€â”€â–º config.py          â”‚
â”‚       â”‚                     â”‚                    â”‚              â”‚
â”‚       â”‚                     â”‚                    â–¼              â”‚
â”‚       â”‚                     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚       â”‚                     â”‚         â”‚ Environment     â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚ Variables:      â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚                 â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚ SNOWFLAKE_*     â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚ GROQ_API_KEY    â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚ MODEL_NAME      â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚ DEBUG           â”‚       â”‚
â”‚       â”‚                     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚                     â”‚                    â”‚              â”‚
â”‚       â”‚                     â”‚                    â–¼              â”‚
â”‚       â”‚                     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚       â”‚                     â”‚         â”‚ Validation &    â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚ Default Values  â”‚       â”‚
â”‚       â”‚                     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚                     â”‚                    â”‚              â”‚
â”‚       â”‚                     â”‚                    â–¼              â”‚
â”‚       â”‚                     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚       â”‚                     â”‚         â”‚ Global Config   â”‚       â”‚
â”‚       â”‚                     â”‚         â”‚ Instance        â”‚       â”‚
â”‚       â”‚                     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Escalabilidad y Mantenimiento

### ğŸ”§ Puntos de ExtensiÃ³n

1. **ğŸŒ Nuevos Idiomas**: Modificar prompt en `nlp_agent.py`
2. **ğŸ—„ï¸  Nuevas Bases de Datos**: Extender `database/` con nuevos conectores
3. **ğŸ¨ Nuevos Formatos**: AÃ±adir casos en `format_sql_result_to_dataframe()`
4. **ğŸ¤– Nuevos LLMs**: Cambiar `ChatGroq` por otro proveedor en `nlp_agent.py`
5. **ğŸ“Š Nuevas Visualizaciones**: Extender UI components en `streamlit_app.py`

### ğŸ›¡ï¸ Aspectos de Seguridad

- âœ… **Variables de entorno** para credenciales sensibles
- âœ… **ValidaciÃ³n de SQL** antes de ejecuciÃ³n  
- âœ… **LIMIT automÃ¡tico** en consultas para evitar sobrecargas
- âœ… **Connection pooling** controlado (NullPool)
- âœ… **Error handling** robusto en cada capa

### ğŸ“Š Monitoreo y Observabilidad

- ğŸ“‹ **Logs paso a paso** en UI para transparencia
- ğŸ” **Trazabilidad completa** del flujo NL â†’ SQL â†’ Resultados  
- â±ï¸ **Timestamps** en logs para anÃ¡lisis de rendimiento
- ğŸ“ˆ **Contadores** de registros y estadÃ­sticas bÃ¡sicas

---

**ğŸ—ï¸ Esta arquitectura estÃ¡ diseÃ±ada para ser modular, extensible y mantenible, siguiendo principios de separaciÃ³n de responsabilidades y bajo acoplamiento.**
